# Feature Engineering Team 설명

NB viewer : https://nbviewer.jupyter.org/gist/rjsdl56/5c72a87684354f6b00bcdcef3e2b7acc



### 1. 프로젝트 개요

 1.1 프로젝트 목표

- 모두컴퍼니 주차장 어플 이용자 한달 사용건수 예측

 1.2. 분석데이터

- 실전db.csv
- 서울시_기상데이터.csv



### 2. 데이터전처리

2.1. 데이터클렌징

​	2.1.1. 데이터 결측치 처리

​		결측치 없음

​	2.1.2. 데이터 이상치 처리

​		일반적인 이용자로 보이지 않는 데이터를 이상치로 판단 

​		다음 조건에 해당하는 이용자는 이상치로 처리

​				연속적으로 이용

​				데이터가 5개 이상

​				AD1이 계속해서 바뀜

​				COUNT 값의 평균이 비정상적으로 높음

​			

 2.2. 데이터변환

- USER_ID : 정수형

- JOIN_DATE : 범주형(문자형)

- D_TYPE : 범주형(문자형)

- STORE_ID : 정수형

- GOODS_TYPE : 범주형(문자형)
- DATE : 범주형(문자형)
- <목표변수> COUNT : 정수형
- AD1 : 범주형(문자형)



### 3. EDA

 3.1. EDA목표

 3.2. EDA분석
	 3.2.1.데이터 분포 확인

- 특정 주 사용 유저들이 존재한다는 사실

- D_TYPE이 CC인 유저는 수가 다른 D_TYPE에 비해 압도적으로 적음

- STORE별로 이용 횟수 차이가 크게 난다는 사실을 알 수 있음

- GOODS_TYPE은 A의 사용이 다른 타입보다 압도적으로 많음

- AD1은 J,GN, JRR의 사용이 다른 변수들보다 비교적 많음

  

​	 3.2.2.데이터간 상관관계를 포함한 데이터 특성 확인

- USER_ID 별로 COUNT 값의 크기가 다른 경향 (상관관계 있음)

- COUNT가 20 이상인 데이터는 특정날짜에 가입한 데이터들로 확인

- D_TYPE을 CC로하는 계약이 (특정날짜에) 이루어졌을 것으로 추정

- 가입년도 최근일 수록 월이용횟수가 증가하는 경향이 있음

  

​	 3.2.3.목표변수와의 상관관계 확인

- COUNT가 25이상의 데이터는 전부 D_TYPE이 CC인 것을 확인
-  다른 컬럼의 영향이 있을 수 있어 다른방식의 접근 필요
- 실제 D_TYPE별 이용횟수의 평균을 구하자 비슷하게 나옴
- 다만 타입별 분포의 특이성을 고려해 컬럼으로 투입
- STORE_ID는 AD1을 구성하는 데이터
- GOODS_TYPE B는 낮은 COUNT를 기록하는 경향이 있음
- 40이상의 COUNT를 기록한 데이터는 GOODS_TYPE이 대부분 A값
- 50이상의 COUNT를 기록한 데이터는 GOODS_TYPE이 모두 A값
- 실제 GOODS_TYPE별 이용횟수의 평균을 구하자 비슷하게 나옴
- 서비스 이용날짜가 최근에 가까워짐에 따라 COUNT의 수가 커지는 경향
- 시계열 순으로 train과 test를 분리했고 기간내 계절과 연의 순환이 없음
- 주중, 주말, 공휴일간 COUNT의 수가 차이 있음
- AD1의 이니셜은 특정 지역인 것으로 추정
- GOODS_TYPE, D_TYPE과 마찬가지로 타입별 분포의 특이성을 고려해 컬럼 생성
- 날씨데이터의 두 컬럼은(강수여부, 이상기온) 모두 월별 카운트 평균을 구하자 비슷하게 나옴
- 다만 강수여부, 이상기온여부 별 분포의 특이성을 고려해 컬럼으로 투입



 3.3. EDA결론
	 3.3.1. EDA정리

​	(1). 평균적을 높은 COUNT 횟수를 기록하는 USER_ID 그룹이 존재
​	(2). 대체적으로 최근에 가입할수록 높은 COUNT 횟수를 기록
​	(3). D_TYPE은 타입별 분포의 특이성을 가짐(상관관계가 있다고 생각됨)
​	(4). STORE_ID는 AD1에 종속된 컬럼으로 AD1이 STORE_ID의 의미를 설명가능하다고 판단
​	(5). GOODS_TYPE은 타입별 분포의 특이성을 가짐(상관관계가 있다고 생각됨)
​	(6). DATE는 시계열 순으로 train과 test데이터를 나누었고 계절이나 연 순환 주기에 대한 판단이 		어려움
​	(7). DATE를 주중,주말,공휴일로 나누자 주중보다는 휴일에 COUNT가 높은 횟수를 기록하는 		상관관계를 보임
​	(8). AD1 지역이니셜로 추정, 지역을 서울과 비서울로 나누자 비서울그룹보다는 서울그룹에서 		COUNT가 높은 횟수를 기록하는 상관관계를 보임
​	(9). 날씨데이터는 기상청의 정의에 따른 이상기후와 강수에 대해서만 일별로 유무를 체크해 컬		럼으로 구성
​	(10). 전체 데이터가 평균적으로 서울 데이터의 날씨와 비슷한 날씨를 보일 것이라는 가설을 수		립(데이터가 수도권에 많을 것이라고 가정)
​	(11). 날씨데이터는 타입별 분포의 특이성을 가짐(상관관계가 있다고 생각됨)
​	(12). 교통량데이터는 서울유입과 비서울로유출되는 교통량데이터로 나뉘는데 비서울로 유출되		는 교통량데이터를 이용하기 힘들다.
​	(13). 일일단위 예측에서 분포의 특이성은 큰 영향이 없을 것으로 생각됨



​	 3.3.2. 가설수립

​	(1).USER_ID를 COUNT횟수 평균에 따라 3그룹으로 나눈 feature는 목표변수를 예측하는데 영		향을 미칠 것이다.
​	(2).JOIN_DATE를 연도별로 나눈 feature는 목표변수를 예측하는데 영향을 미칠 것이다.
​	(3). D_TYPE은 목표변수를 예측하는데 영향을 미칠 것이다.
​	(4). STORE_ID는 AD1과 다중공산성을 보일것이며 AD1이 STORE_ID의 설명력을 포함할 것이다.
​	(5). GOODS_TYPE은 목표변수를 예측하는데 영향을 미칠 것이다.
​	(6). DATE을 주중,주말,공휴일로 나눈 feature는 목표변수를 예측하는데 영향을 미칠 것이다.
​	(7). AD1을 서울과 비서울 지역으로 나눈 feature는 목표변수를 예측하는데 영향을 미칠 것이다.
​	(8). 이상기후와 강수 여부를 기록한 feature들은 목표변수를 예측하는데 영향을 미칠 것이다.



### 4. 모델링 및 검증

4.1. 이용자 일일(행별 카운트)단위 예측 모델링

 - 일일 카운트 예측에 영향력이 있는 컬럼만 이용
   		- ["DATE",'USER_ID', 'AD1_TYPE_SEOUL', 'DAY_TYPE_주중', 'DAY_TYPE_주말', 'DAY_TYPE_공휴일', '강수여부', '이상기온', 'USER_ID_TYPE_A', 'USER_ID_TYPE_B', 'USER_ID_TYPE_C']
 - 가장 성능 좋은 모델 확인을 위한 4가지 default모델 예측 
   		-  GradientBoostingRegressor, XGBRegressor, LGBMRegressor, RandomForestRegressor
      		- 가장 결과가 좋았던 LGBMRegressor을 이용한 예측
             		- 최상의 파라미터를 도출하기 위한 GridSearchCV 활용

- 이용자 일일(행별 카운트) 단위 예측 모델링 결과
  - MSE : 0.03560501243087223



4.2. 이용자 별 한달단위 이용 횟수 예측 모델링

- 한 달 단위 예측을 위한 Sum 작업 수행

 - 한 달 단위 예측에 영향력이 있는 컬럼만 이용
    - ['MONTH', 'COUNT', '공휴일', '주말', '주중', '강수여부', '이상기온', 'USER_ID',
        'D_AA', 'D_BB', 'D_CC', 'GOODS_A', 'GOODS_B', 'GOODS_C', 'GOODS_D']

- 가장 성능 좋은 모델 확인을 위한 4가지 default모델 예측 

  -  GradientBoostingRegressor, LGBMRegressor, RandomForestRegressor

  - 가장 결과가 좋았던 LGBMRegressor을 이용한 예측

  - 최상의 파라미터를 도출하기 위한 GridSearchCV 활용

    

### 5. 최종결론

한 달 단위 예측 결과

```
최종 mse(lightgbm모델 사용) :  0.26355187894719134
최종 mae(lightgbm모델 사용) :  0.10392207522470769
```